### Упражнение 1.27.

Покажите, что числа Кармайкла, перечисленные в сноске 47, действительно «обманывают» тест Ферма: напишите процедуру, которая берет целое число `n` и проверяет, правда ли a<sup>n</sup> равняется `a` по модулю `n` для всех `a < n`, и проверьте эту процедуру на этих числах Кармайкла.

"Числа, «обманывающие» тест Ферма, называются числами Кармайкла (Carmichael numbers), и про них почти ничего неизвестно, кроме того, что они очень редки. Существует 255 чисел Кармайкла, меньших 100 000 000. Несколько первых — 561, 1105, 1729, 2465, 2821 и 6601."

### Решение

```scheme
  (define (square x) (* x x))

  (define (expmod base exp m)
      (cond ((= exp 0) 1)
            ((even? exp)
              (remainder (square (expmod base (/ exp 2) m))
                         m))
            (else
              (remainder (* base (expmod base (- exp 1) m))
                         m))))

  (define (carmichael-number? n)
    (define (try-it n a)
      (cond ((= a 1) #t)
            ((not (= (expmod a n n) a)) #f)
            (else (try-it n (- a 1)))))

    (try-it n (- n 1)))                       
```
